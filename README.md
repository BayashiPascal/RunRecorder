# RunRecorder

RunRecorder is a C library and a Web API helping to interface the acquisition of textual data and their recording in a remote or local SQLite database.

The C library allows the user to record data with a small and simple set of functions, hiding the commands to and management of the database.

The Web API allows the user to use a remote database, making RunRecorder suitable for distributed environments where several applications in a network of devices record and access data in a shared and centralized scheme.

The C library can interact directly with the database, or remotely with it through the Web API. It acts as an abstraction layer for the difference between the two modes, allowing the user to develop data recording application without worrying whether the database is local or remote.

The Web API responding consistently regardless of the source of the requests, it can also be used with programming languages or tools able to perform HTTP requests. The [Curl](https://curl.se/) project provides such tools and libraries in more than 50 languages. Then, the Web API can also easily be reused in other projects and environments.

RunRecorder uses SQLite databases to store recorded data. [SQLite](https://www.sqlite.org/) is the most widely deployed database engine and benefits of tools and libraries in all OS and many programming languages. Then, the recorded data can easily be used after recording.j with third party software and libraries.

In the SQLite database, data are organised according to a meta-model of the recorded data. To make the manipulation of recorded data easier to the user, Views are automatically generated by RunRecorder to present data of each project (cf below) as a single table.

RunRecorder provides a simple functionality to retrieve the recorded data in CSV or JSON format, but it focus on the recording of data so the use of the recorded data is mainly left to the user. A basic Web viewer using the Web API to display the recorded data in a Web browser is also available, and a CLI for the C library allows to interact with local and remote databases from the terminal.

In the examples above, I use a fictional project where the user wants to record the temperature of a room. The temperature acquisition is not detailed here, but it could be a sensor on a Raspberry Pi. Then, RunRecorder would make very simple to save the temperature into a database, with some C code, shell script, or any language supporting Curl.

RunRecorder is currently in beta version. It has been tested and dynamically analysed with [Valgrind](https://valgrind.org/). It is currently used on a few private projects to assess its stability and qualification.

## Table Of Content

1 Install
1.1 C library
1.2 Web API
2 Usage
2.1 Through the C library
2.1.1 Get the version
2.1.2 Create a new project
2.1.3 Get the list of projects
2.1.4 Create a new metric
2.1.5 Get the list of metrics
2.1.6 Add a measure
2.1.7 Delete a measure
2.1.8 Get the measures
2.1.9 Delete a project
2.2 Through the Web API
2.2.1 Help
2.2.2 Get the version
2.2.3 Create a new project
2.2.4 Get the list of projects
2.2.5 Create a new metric
2.2.6 Get the list of metrics
2.2.7 Add a measure
2.2.8 Delete a measure
2.2.9 Get the measures
2.2.10 Delete a project
2.3 From the command line, with Curl
2.3.1 Help
2.3.2 Get the version
2.3.3 Create a new project
2.3.4 Get the list of projects
2.3.5 Create a new metric
2.3.6 Get the list of metrics
2.3.7 Add a measure
2.3.8 Delete a measure
2.3.9 Get the measures
2.3.10 Delete a project
2.4 From the command line, with the RunRecorder CLI
2.4.1 Create a new project
2.4.2 Get the list of projects
2.4.3 Create a new metric
2.4.4 Get the list of metrics
2.4.5 Add a measure
2.4.6 Delete a measure
2.4.7 Get the measures
2.4.8 Delete a project
2.5 From other languages, with HTTP request (e.g. JavaScript)
2.5.1 Get the version
2.5.2 Create a new project
2.5.3 Get the list of projects
2.5.4 Create a new metric
2.5.5 Get the list of metrics
2.5.6 Add a measure
2.5.7 Delete a measure
2.5.8 Get the measures
2.5.9 Delete a project
3 Web viewer
4 License

# 1 Install

Download this repository into a folder of your choice, in the examples below I'll call it `Repos`, as follow:
```
cd Repos
wget https://github.com/BayashiPascal/RunRecorder/archive/main.zip
unzip main.zip
mv RunRecorder-main RunRecorder
rm main.zip
```

## 1.1 C library

Compile the RunRecorder C library as follow:

```
cd Repos/RunRecorder/C
make all
sudo make install
```

The [SQLite](https://www.sqlite.org/), [Curl](https://curl.se/) and [TryCatchC](https://github.com/BayashiPascal/TryCatchC) libraries will automatically be installed during installation. You may be asked for your password during installation.

## 1.2 Web API

Install the Web API to your local server or web server by uploading, copying or linking the folder `Repos/RunRecorder/WebAPI` to an URL of your choice on the server. For example, if you're using [LAMP](https://en.wikipedia.org/wiki/LAMP_(software_bundle)) and want to access the API via `https://localhost/RunRecorder/api.php` it should look something like this:
```
sudo ln -s Repos/RunRecorder/WebAPI /var/www/html/RunRecorder
```

*If you use a web server, be aware that the Web API doesn't implement any kind of security mechanism. Anyone knowing the URL of the API will be able to interact with it. If you have security concerns, use the API on a secured local network, or use it after modifying the code of the API according to your security policy.*

# 2 Usage

## 2.1 Through the C library

You can use the C library as introduced in the minimal example below

```
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";
  char const* pathApi = "https://localhost/RunRecorder/api.php";

  // Create the RunRecorder instance
  // Give pathApi in argument if you want to use the Web API instead
  // of a local database
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);

  // Initialise the RunRecorder instance
  Try {

    RunRecorderInit(recorder);

  } CatchDefault {

    exit(EXIT_FAILURE);

  } EndTryWithDefault;

  // Your code using RunRecorder here (see below for details)
  // ...

  // Free memory
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```

In examples below the Try/Catch blocks are omitted to shorten this documentation. Refer to `Repos/RunRecorder/C/main.c` for more information.

Compile with the following Makefile:

```
main: main.o
	gcc main.o -lsqlite3 -lm -lpthread -ldl -lcurl -ltrycatchc -o main 

main.o: main.c
	gcc -c main.c 
```

### 2.1.1 Get the version

A first simple test to check if everything is working fine is to request the version of the database.

The database version is automatically checked each a RunRecorder instance is created and the database is automatically upgraded if needed.

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Get the version of the database
  char* version = RunRecorderGetVersion(recorder);
  printf(
    "%s\n",
    version);
  free(version);

  // Free memory
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```
Output:
```
01.00.00
```

### 2.1.2 Create a new project

In RunRecorder, data are grouped by projects. To start recording data, the first thing you need to do is to create the project they belong to.

The project's name must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`.

```
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Create a new project
  RunRecorderAddProject(
    recorder,
    "RoomTemperature");

  // Free memory
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```

### 2.1.3 Get the list of projects

You can check the list of projects in the database as follow.

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Get the projects
  struct RunRecorderPairsRefVal* projects = RunRecorderGetProjects(recorder);
  for (
    long iProject = 0;
    iProject < projects->nb;
    ++iProject) {

    printf(
      "ref: %ld label: %s\n",
      projects->refs[iProject],
      projects->values[iProject]);

  }

  // Free memory
  RunRecorderPairsRefValFree(&projects);
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```
Output:
```
ref: 1 label: RoomTemperature
```

### 2.1.4 Create a new metric

After adding a new project you'll want to add the metrics that defines this project. In the example below there are two metrics: the date and time of the recording, and the recorded room temperature.

*The metric's label must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`. The default value of the metric must respect the following pattern: `/^[^"=&]+$*/`. There cannot be two metrics with the same label for the same project. A metric's label can't be 'action' or 'project' (case sensitive, so 'Action' is fine).*

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Add metrics to the project
  RunRecorderAddMetric(
    recorder,
    "RoomTemperature",
    "Date",
    "-");
  RunRecorderAddMetric(
    recorder,
    "RoomTemperature",
    "Temperature",
    "0.0");

  // Free memory
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```

You can add more metrics even after having recorded some data. A measurement with no value for a given metric automatically get attributed the default value of this metric.

### 2.1.5 Get the list of metrics

You can get the list of metrics for a project as follow.

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Get the metrics
  struct RunRecorderPairsRefValDef* metrics =
    RunRecorderGetMetrics(
      recorder,
      "RoomTemperature");
  for (
    long iMetric = 0;
    iMetric < metrics->nb;
    ++iMetric) {

    printf(
      "ref: %ld label: %s default: %s\n",
      metrics->refs[iMetric],
      metrics->values[iMetric],
      metrics->defaultValues[iMetric]);

  }

  // Free memory
  RunRecorderPairsRefValDefFree(&metrics);
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```
Output:
```
ref: 1 label: Date default: -
ref: 2 label: Temperature default: 0.0
```

### 2.1.6 Add a measure

Once you've created a project and set its metrics, you're ready to add measures!

The values of the measure must respect the following pattern: `/^[^"=&]+$*/`. It is not mandatory to provide a value for all the metrics of the project (if missing, the default value is used instead).

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Create the measure
  struct RunRecorderMeasure* measure = RunRecorderMeasureCreate();
  RunRecorderMeasureAddValue(
    measure,
    "Date",
    "2021-03-08 15:45:00");
  RunRecorderMeasureAddValue(
    measure,
    "Temperature",
    18.5);

  // Add a measure
  RunRecorderAddMeasure(
    recorder,
    "RoomTemperature",
    measure);
  printf(
    "Added measure ref. %ld\n",
    recorder->refLastAddedMeasure);

  // Free memory
  RunRecorderMeasureFree(&measure);
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```
Output:
```
Added measure ref. 1
```

### 2.1.7 Delete a measure

If you've mistakenly added a measure, or if an error occured when addind a measure and it may be partially saved in the database, you can delete the measure.

RunRecorder ensures as much as possible the database stays coherent even if there is an error, so you can use the partially saved data. In the other hand if you don't want to keep potentially incomplete measurement, you should always try to delete it.

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Create the measure
  struct RunRecorderMeasure* measure = RunRecorderMeasureCreate();
  RunRecorderMeasureAddValue(
    measure,
    "Date",
    "2021-03-08 15:45:00");
  RunRecorderMeasureAddValue(
    measure,
    "Temperature",
    18.5);

  Try {

    // Add a measure
    RunRecorderAddMeasure(
      recorder,
      "RoomTemperature",
      measure);
    printf(
      "Added measure ref. %ld\n",
      recorder->refLastAddedMeasure);

    // Raise an exception to simulate an error during addition of the measure
    Raise(TryCatchExc_MallocFailed);

  } CatchDefault {

    printf(
      "Error occured, delete the last added measure ref. %ld\n",
      recorder->refLastAddedMeasure);
    RunRecorderDeleteMeasure(
      recorder,
      recorder->refLastAddedMeasure);

  } EndTryCatchWithDefault;

  // Free memory
  RunRecorderMeasureFree(&measure);
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```
Output:
```
Added measure ref. 1
Error occured, delete the last added measure ref. 1
```

### 2.1.8 Get the measures

After adding your measurements you'll want to retrieve them. You can do so as follow.

RunRecorder retrieve the data as a structure which you could use according to your needs. For convenience, it also provides a function to convert this structure to CSV format and print it to a stream.

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Get the measures
  struct RunRecorderMeasures* measures =
    RunRecorderGetMeasures(
      recorder,
      "RoomTemperature");

  // Print the measures in CSV format on the standard output
  RunRecorderMeasuresPrintCSV(
    measures,
    stdout);

  // Free memory
  RunRecorderMeasuresFree(&measures);
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```
Output:
```
Ref&Date&Temperature
1&2021-03-08 15:45:00&18.500000
2&2021-03-09 15:45:00&19.500000
3&2021-03-10 15:45:00&20.500000
```

Metrics (columns) are ordered alphabetically (except for the first column which is always the reference of the measure), measures (rows) are ordered by time of creation in the database. The delimiter of columns for the CSV conversion is ampersand `&`, and the first line contains the label of metrics. All metrics of the project are present, and their default value is used in rows containing missing values.

If you have a lot of data and want to retrieve only the most recent ones, it is possible to do so as follow. In that case, rows are ordered from the most recent to the oldest.

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Get the last 2 measures
  long nbMeasure = 2;
  struct RunRecorderMeasures* measures =
    RunRecorderGetLastMeasures(
      recorder,
      "RoomTemperature",
      nbMeasure);

  // Print the measures in CSV format on the standard output
  RunRecorderMeasuresPrintCSV(
    measures,
    stdout);

  // Free memory
  RunRecorderMeasuresFree(&measures);
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```
Output:
```
Ref&Date&Temperature
3&2021-03-10 15:45:00&20.500000
2&2021-03-09 15:45:00&19.500000
```

### 2.1.9 Delete a project

Once you've finished collecting data for a project and want to free space in the database, you can delete the project and all the associated metrics and measurements as follow. 

```
#include <stdio.h>
#include <RunRecorder/runrecorder.h>

int main() {

  char const* pathDb = "./runrecorder.db";

  // Create the RunRecorder instance
  struct RunRecorder* recorder = RunRecorderCreate(pathDb);
  RunRecorderInit(recorder);

  // Delete the project
  RunRecorderFlushProject(
    recorder,
    "RoomTemperature");

  // Free memory
  RunRecorderFree(&recorder);

  return EXIT_SUCCESS;

}
```

## 2.2 Through the Web API

You can use the Web API to manipulate a remote database by sending HTTP requests to the copy of `Repos/RunRecorder/api.php` on your server. The parameters of the request must be sent with method `POST` and consist of at one parameter: `action=...` specifying the action to be performed on the database, and optionally several others arguments.

The available actions and their parameters are explained in the following sections with their returned value. On success, the API returns JSON or raw data depending on the command. On failure, it returns an error as follow:
```
{"ret":"1","errMsg":"..."}
```

### 2.2.1 Help

If you have forgotten the list of actions and their parameters you can get their list as follow

```
action=help
```
Return:
```
{"ret":"0","actions":"version, add_project&label=..., projects, add_metric&project=...&label=...&default=..., metrics&project=..., add_measure&project=...&...=...&..., delete_measure&measure=..., measures&project=...[&last=...(default: 0)], csv&project=...[&sep=...(default: &)&last=...(default: 0)], flush&project=..."}
```

### 2.2.2 Get the version

A first simple test to check if everything is working fine is to request the version of the database.

The database version is automatically checked each a RunRecorder instance is created and the database is automatically upgraded if needed.

```
action=version
```
Return:
```
{"version":"01.00.00","ret":"0"}
```

### 2.2.3 Create a new project

In RunRecorder, data are grouped by projects. To start recording data, the first thing you need to do is to create the project they belong to.

The project's name must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`.

```
action=add_project&label=RoomTemperature
```
Return:
```
{"ret":"0"}
```

### 2.2.4 Get the list of projects

You can check the list of projects in the database as follow.

```
action=projects
```
Return:
```
{"projects":{"1":"RoomTemperature"},"ret":"0"}
```

### 2.2.5 Create a new metric

After adding a new project you'll want to add the metrics that defines this project. In the example below there are two metrics: the date and time of the recording, and the recorded room temperature.

*The metric's label must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`. The default value of the metric must respect the following pattern: `/^[^"=&]+$*/`. There cannot be two metrics with the same label for the same project. A metric's label can't be 'action' or 'project' (case sensitive, so 'Action' is fine).*

```
action=add_metric&project=RoomTemperature&label=Date&default=-
```
Return:
```
{"ret":"0"}
```
Second metric:
```
action=add_metric&project=RoomTemperature&label=Temperature&default=0.0
```
Return:
```
{"ret":"0"}
```

You can add more metrics even after having recorded some data. A measurement with no value for a given metric automatically get attributed the default value of this metric.

### 2.2.6 Get the list of metrics

You can get the list of metrics for a project as follow.

```
action=metrics&project=RoomTemperature
```
Return:
```
{"metrics":{"1":{"Label":"Date","DefaultValue":"-"},"2":{"Label":"Temperature","DefaultValue":"0.0"}},"ret":"0"}
```

### 2.2.7 Add a measure

Once you've created a project and set its metrics, you're ready to add measures!

The values of the measure must respect the following pattern: `/^[^"=&]+$*/`. It is not mandatory to provide a value for all the metrics of the project (if missing, the default value is used instead).

```
action=add_measure&project=RoomTemperature&Date=2021-03-08 15:45:00&Temperature=18.5
```
Return:
```
{"refMeasure":"1","ret":"0"}
```

### 2.2.8 Delete a measure

If you've mistakenly added a measure, or if an error occured when addind a measure and it may be partially saved in the database, you can delete the measure.

RunRecorder ensures as much as possible the database stays coherent even if there is an error, so you can use the partially saved data. In the other hand if you don't want to keep potentially incomplete measurement, you should always try to delete it.

```
action=delete_measure&project=RoomTemperature&measure=1
```
Return:
```
{"ret":"0"}
```

### 2.2.9 Get the measures

After adding your measurements you'll want to retrieve them. You can do so as follow.

RunRecorder retrieve the data as a structure which you could use according to your needs. For convenience, it also provides a function to convert this structure to CSV format and print it to a stream.

```
action=csv&project=RoomTemperature
```
Return:
```
Ref&Date&Temperature
1&2021-03-08 15:45:00&18.5
2&2021-03-09 15:45:00&19.5
3&2021-03-10 15:45:00&20.5
```

The optional argument `sep` can be given to use another separator for columns.

```
action=csv&project=RoomTemperature&sep=,
```
Return:
```
Ref,Date,Temperature
1,2021-03-08 15:45:00,18.5
2,2021-03-09 15:45:00,19.5
3,2021-03-10 15:45:00,20.5
```
Metrics (columns) are ordered alphabetically (except for the first column which is always the reference of the measure), measures (rows) are ordered by time of creation in the database. The delimiter of columns for the CSV conversion is ampersand `&`, and the first line contains the label of metrics. All metrics of the project are present, and their default value is used in rows containing missing values.

It is also possible to get the data returned in JSON format:

```
action=measures&project=RoomTemperature
```
Return:
```
{"labels":["Ref","Date","Temperature"],"values":[[1,"2021-03-08 15:45:00","18.5"],[2,"2021-03-09 15:45:00","19.5"],[3,"2021-03-10 15:45:00","20.5"]],"ret":"0"}
```

If you have a lot of data and want to retrieve only the most recent ones, it is possible to do so with the optional parameters `last` (for both `measures` and `csv` commands). In that case, rows are ordered from the most recent to the oldest.

```
action=measures&project=RoomTemperature&last=2
```
Return:
```
{"labels":["Ref","Date","Temperature"],"values":[[3,"2021-03-10 15:45:00","20.5"],[2,"2021-03-09 15:45:00","19.5"]],"ret":"0"}
```

### 2.2.10 Delete a project

Once you've finished collecting data for a project and want to free space in the database, you can delete the project and all the associated metrics and measurements as follow. 

```
action=flush&project=RoomTemperature
```
Return:
```
{"ret":"0"}
```

## 2.3 From the command line, with Curl

Section 2.2 gives the parameters of the HTTP request used to interact with the Web API. The present section shows how to use the Curl command line tool to actually interact with the Web API from your terminal.

The Curl command looks like below, where `<PARAMETERS>` is to be replaced with the parameters given in section 2.2

```
curl -d "<PARAMETERS>" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```

### 2.3.1 Help

If you have forgotten the list of actions and their parameters you can get their list as follow

```
curl -d "action=help" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"ret":"0","actions":"version, add_project&label=..., projects, add_metric&project=...&label=...&default=..., metrics&project=..., add_measure&project=...&...=...&..., delete_measure&measure=..., measures&project=...[&last=...(default: 0)], csv&project=...[&sep=...(default: &)&last=...(default: 0)], flush&project=..."}
```

### 2.3.2 Get the version

A first simple test to check if everything is working fine is to request the version of the database.

The database version is automatically checked each a RunRecorder instance is created and the database is automatically upgraded if needed.

```
curl -d "action=version" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"version":"01.00.00","ret":"0"}
```

### 2.3.3 Create a new project

In RunRecorder, data are grouped by projects. To start recording data, the first thing you need to do is to create the project they belong to.

The project's name must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`.

```
curl -d "action=add_project&label=RoomTemperature" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"ret":"0"}
```

### 2.3.4 Get the list of projects

You can check the list of projects in the database as follow.

```
curl -d "action=projects" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"projects":{"1":"RoomTemperature"},"ret":"0"}
```

### 2.3.5 Create a new metric

After adding a new project you'll want to add the metrics that defines this project. In the example below there are two metrics: the date and time of the recording, and the recorded room temperature.

*The metric's label must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`. The default value of the metric must respect the following pattern: `/^[^"=&]+$*/`. There cannot be two metrics with the same label for the same project. A metric's label can't be 'action' or 'project' (case sensitive, so 'Action' is fine).*

```
curl -d "action=add_metric&project=RoomTemperature&label=Date&default=-" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"ret":"0"}
```
Second metric:
```
curl -d "action=add_metric&project=RoomTemperature&label=Temperature&default=0.0" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"ret":"0"}
```

You can add more metrics even after having recorded some data. A measurement with no value for a given metric automatically get attributed the default value of this metric.

### 2.3.6 Get the list of metrics

You can get the list of metrics for a project as follow.

```
curl -d "action=metrics&project=RoomTemperature" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"metrics":{"1":{"Label":"Date","DefaultValue":"-"},"2":{"Label":"Temperature","DefaultValue":"0.0"}},"ret":"0"}
```

### 2.3.7 Add a measure

Once you've created a project and set its metrics, you're ready to add measures!

The values of the measure must respect the following pattern: `/^[^"=&]+$*/`. It is not mandatory to provide a value for all the metrics of the project (if missing, the default value is used instead).

```
curl -d "action=add_measure&project=RoomTemperature&Date=2021-03-08 15:45:00&Temperature=18.5" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"refMeasure":"1","ret":"0"}
```

### 2.3.8 Delete a measure

If you've mistakenly added a measure, or if an error occured when addind a measure and it may be partially saved in the database, you can delete the measure.

RunRecorder ensures as much as possible the database stays coherent even if there is an error, so you can use the partially saved data. In the other hand if you don't want to keep potentially incomplete measurement, you should always try to delete it.

```
curl -d "action=delete_measure&project=RoomTemperature&measure=1" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"ret":"0"}
```

### 2.3.9 Get the measures

After adding your measurements you'll want to retrieve them. You can do so as follow.

RunRecorder retrieve the data as a structure which you could use according to your needs. For convenience, it also provides a function to convert this structure to CSV format and print it to a stream.

```
curl -d "action=csv&project=RoomTemperature" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
Ref&Date&Temperature
1&2021-03-08 15:45:00&18.5
2&2021-03-09 15:45:00&19.5
3&2021-03-10 15:45:00&20.5
```

The optional argument `sep` can be given to use another separator for columns.

```
curl -d "action=csv&project=RoomTemperature&sep=," -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
Ref,Date,Temperature
1,2021-03-08 15:45:00,18.5
2,2021-03-09 15:45:00,19.5
3,2021-03-10 15:45:00,20.5
```
Metrics (columns) are ordered alphabetically (except for the first column which is always the reference of the measure), measures (rows) are ordered by time of creation in the database. The delimiter of columns for the CSV conversion is ampersand `&`, and the first line contains the label of metrics. All metrics of the project are present, and their default value is used in rows containing missing values.

It is also possible to get the data returned in JSON format:

```
curl -d "action=measures&project=RoomTemperature" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"labels":["Ref","Date","Temperature"],"values":[[1,"2021-03-08 15:45:00","18.5"],[2,"2021-03-09 15:45:00","19.5"],[3,"2021-03-10 15:45:00","20.5"]],"ret":"0"}
```

If you have a lot of data and want to retrieve only the most recent ones, it is possible to do so with the optional parameters `last` (for both `measures` and `csv` commands). In that case, rows are ordered from the most recent to the oldest.

```
curl -d "action=measures&project=RoomTemperature&last=2" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"labels":["Ref","Date","Temperature"],"values":[[3,"2021-03-10 15:45:00","20.5"],[2,"2021-03-09 15:45:00","19.5"]],"ret":"0"}
```

### 2.3.10 Delete a project

Once you've finished collecting data for a project and want to free space in the database, you can delete the project and all the associated metrics and measurements as follow. 

```
curl -d "action=flush&project=RoomTemperature" -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
Return:
```
{"ret":"0"}
```

## 2.4 From the command line, with the RunRecorder CLI

The CLI is compiled and install during installation of the C library. You can start it with the following command:
```
runrecorder <path to database or api>
```

If you provide a path to a local file it will be used as database, else if you provide a url (starting with `http`) it will be used as the Web API to interact with a remote database.

### 2.4.1 Create a new project

In RunRecorder, data are grouped by projects. To start recording data, the first thing you need to do is to create the project they belong to.

The project's name must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`.

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 2

--- Add a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > q  
Exiting from RunRecorder. Bye!
Disconnected from the database
```

### 2.4.2 Get the list of projects

You can check the list of projects in the database as follow.

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 1

Projects:
ref: 1 label: RoomTemperature


--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

### 2.4.3 Create a new metric

After adding a new project you'll want to add the metrics that defines this project. In the example below there are two metrics: the date and time of the recording, and the recorded room temperature.

*The metric's label must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`. The default value of the metric must respect the following pattern: `/^[^"=&]+$*/`. There cannot be two metrics with the same label for the same project. A metric's label can't be 'action' or 'project' (case sensitive, so 'Action' is fine).*

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 3

--- Select a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 5

--- Add a metric ---
Enter the label of the metric, or leave blank to cancel
 > Date
Enter the default value of the metric, or ctrl-d to cancel
 > -

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 5

--- Add a metric ---
Enter the label of the metric, or leave blank to cancel
 > Temperature
Enter the default value of the metric, or ctrl-d to cancel
 > 0.0

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

You can add more metrics even after having recorded some data. A measurement with no value for a given metric automatically get attributed the default value of this metric.

### 2.4.4 Get the list of metrics

You can get the list of metrics for a project as follow.

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 3

--- Select a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 4

Metrics:
ref: 1, label: Date, default value: -
ref: 2, label: Temperature, default value: 0.0


--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

### 2.4.5 Add a measure

Once you've created a project and set its metrics, you're ready to add measures!

The values of the measure must respect the following pattern: `/^[^"=&]+$*/`. It is not mandatory to provide a value for all the metrics of the project (if missing, the default value is used instead).

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 3

--- Select a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 6

--- Add a measure ---
c - Cancel and go back to main menu
s - Save the measure
1 - Date: - (default value)
2 - Temperature: 0.0 (default value)
 > 1
Enter the value of the measure for Date, or ctrl-d to cancel
 > 2021-03-08 15:45:00

--- Add a measure ---
c - Cancel and go back to main menu
s - Save the measure
1 - Date: 2021-03-08 15:45:00
2 - Temperature: 0.0 (default value)
 > 2
Enter the value of the measure for Temperature, or ctrl-d to cancel
 > 18.5

--- Add a measure ---
c - Cancel and go back to main menu
s - Save the measure
1 - Date: 2021-03-08 15:45:00
2 - Temperature: 18.5
 > s

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

### 2.4.6 Delete a measure

If you've mistakenly added a measure, or if an error occured when addind a measure and it may be partially saved in the database, you can delete the measure.

RunRecorder ensures as much as possible the database stays coherent even if there is an error, so you can use the partially saved data. In the other hand if you don't want to keep potentially incomplete measurement, you should always try to delete it.

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 3

--- Select a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 8

--- Delete a measure ---
Input the reference of the measure to delete, or leave blank to cancel
 > 1
Deleted measure 1

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

### 2.4.7 Get the measures

After adding your measurements you'll want to retrieve them. You can do so as follow.

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 3   

--- Select a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 7

--- List measures ---
Input the number of most recent measures to display or leave blank for all the measures
 > 
Ref&Date&Temperature
1&2021-03-08 15:45:00&18.5
2&2021-03-09 15:45:00&19.5
3&2021-03-10 15:45:00&20.5

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

Metrics (columns) are ordered alphabetically (except for the first column which is always the reference of the measure), measures (rows) are ordered by time of creation in the database. The delimiter of columns for the CSV conversion is ampersand `&`, and the first line contains the label of metrics. All metrics of the project are present, and their default value is used in rows containing missing values.

If you have a lot of data and want to retrieve only the most recent ones, it is possible to do so as follow. In that case, rows are ordered from the most recent to the oldest.

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 3

--- Select a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 7

--- List measures ---
Input the number of last recent measures to display or leave blank for all the measures
 > 2
Ref&Date&Temperature
3&2021-03-10 15:45:00&20.5
2&2021-03-09 15:45:00&19.5

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

### 2.4.8 Delete a project

Once you've finished collecting data for a project and want to free space in the database, you can delete the project and all the associated metrics and measurements as follow. 

```
Connecting to database runrecorder.db...
Connection established
Welcome to RunRecorder version 01.00.00

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > 3

--- Select a project ---
Enter the name of the project, or leave blank to cancel
 > RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
4 - List the metrics of RoomTemperature
5 - Add a metric to RoomTemperature
6 - Add one measure to RoomTemperature
7 - List measures in RoomTemperature
8 - Delete a measure in RoomTemperature
9 - Delete the project RoomTemperature
q - Quit
 > 9

--- Delete a project ---
The project RoomTemperature and all its data will be deleted, enter 'Y' to confirm or anything else to cancel
 > Y
Deleted project RoomTemperature

--- Main menu ---
1 - List the projects
2 - Add a project
3 - Select a project
q - Quit
 > q
Exiting from RunRecorder. Bye!
Disconnected from the database
```

## 2.5 From other languages, with HTTP request (e.g. JavaScript)

### 2.5.1 Get the version

A first simple test to check if everything is working fine is to request the version of the database.

The database version is automatically checked each a RunRecorder instance is created and the database is automatically upgraded if needed.

```
```
Return:
```
01.00.00
```

### 2.5.2 Create a new project

In RunRecorder, data are grouped by projects. To start recording data, the first thing you need to do is to create the project they belong to.

The project's name must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`.

```
```

### 2.5.3 Get the list of projects

You can check the list of projects in the database as follow.

```
```
Return:
```
ref: 1 label: RoomTemperature
```

### 2.5.4 Create a new metric

After adding a new project you'll want to add the metrics that defines this project. In the example below there are two metrics: the date and time of the recording, and the recorded room temperature.

*The metric's label must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`. The default value of the metric must respect the following pattern: `/^[^"=&]+$*/`. There cannot be two metrics with the same label for the same project. A metric's label can't be 'action' or 'project' (case sensitive, so 'Action' is fine).*

```
```

You can add more metrics even after having recorded some data. A measurement with no value for a given metric automatically get attributed the default value of this metric.

### 2.5.5 Get the list of metrics

You can get the list of metrics for a project as follow.

```
```
Return:
```
ref: 1 label: Date default: -
ref: 2 label: Temperature default: 0.0
```

### 2.5.6 Add a measure

Once you've created a project and set its metrics, you're ready to add measures!

The values of the measure must respect the following pattern: `/^[^"=&]+$*/`. It is not mandatory to provide a value for all the metrics of the project (if missing, the default value is used instead).

```
```
Return:
```
Added measure ref. 1
```

### 2.5.7 Delete a measure

If you've mistakenly added a measure, or if an error occured when addind a measure and it may be partially saved in the database, you can delete the measure.

RunRecorder ensures as much as possible the database stays coherent even if there is an error, so you can use the partially saved data. In the other hand if you don't want to keep potentially incomplete measurement, you should always try to delete it.

```
```
Return:
```
Added measure ref. 1
Error occured, delete the last added measure ref. 1
```

### 2.5.8 Get the measures

After adding your measurements you'll want to retrieve them. You can do so as follow.

RunRecorder retrieve the data as a structure which you could use according to your needs. For convenience, it also provides a function to convert this structure to CSV format and print it to a stream.

```
```
Return:
```
Ref&Date&Temperature
1&2021-03-08 15:45:00&18.500000
```

Metrics (columns) are ordered alphabetically (except for the first column which is always the reference of the measure), measures (rows) are ordered by time of creation in the database. The delimiter of columns for the CSV conversion is ampersand `&`, and the first line contains the label of metrics. All metrics of the project are present, and their default value is used in rows containing missing values.

If you have a lot of data and want to retrieve only the most recent ones, it is possible to do so as follow. In that case, rows are ordered from the most recent to the oldest.

```
```
Return:
```
Ref&Date&Temperature
1&2021-03-08 15:45:00&18.500000
```

### 2.5.9 Delete a project

Once you've finished collecting data for a project and want to free space in the database, you can delete the project and all the associated metrics and measurements as follow. 

```
```

## Usage

I'll consider the example of recording one's room temperature to illustrate the usage of RunRecorder.

### Through the Web API

One can send commands to the Web API as follow (`<action>` and `<data>` are explained in the following sections):

*  using [Curl](https://curl.se/) from the command line:
```
curl -d 'action=<action>&<data>' -H "Content-Type: application/x-www-form-urlencoded" -X POST https://localhost/RunRecorder/api.php
```
* using the provided shell script from the command line:
For ease of use, a shell script is available: `Repos/RunRecorder/WebAPI/runrecorder.sh`. Replace in this script `https://localhost/RunRecorder/` with the URL to your copy of the Web API, ensure it's executable (for example, `chmod +x Repos/RunRecorder/WebAPI/runrecorder.sh`) and accessible (for example, add `export PATH=$PATH:Repos/RunRecorder/WebAPI/` in your `~/.profile`). Then you'll be able to send command to the Web API as follow: `runrecorder.sh <action> '<data>'`.
* if you use C:
You should consider using the RunRecorder C library (see next section), but you can also do it as follow:
```
#include <stdio.h>
#include <curl/curl.h>
int main() {
  CURL *curl;
  CURLcode res;
  curl_global_init(CURL_GLOBAL_ALL);
  curl = curl_easy_init();
  if(curl) {
    curl_easy_setopt(curl, CURLOPT_URL, "https://localhost/RunRecorder/api.php");
    curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "action=<action>&<data>");
    res = curl_easy_perform(curl);
    if (res != CURLE_OK)
      fprintf(stderr, "curl_easy_perform() failed: %s\n", 
              curl_easy_strerror(res));
    curl_easy_cleanup(curl);
  }
  curl_global_cleanup();
  return 0;
}
```
* if you use [JavaScript](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/send):
```
var xhr = new XMLHttpRequest();
xhr.open("POST", 'https://localhost/RunRecorder/api.php', true);
xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
xhr.onreadystatechange = function() {
  if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
    console.log(this.responseText);
  }
}
xhr.send("action=<action>&<data>");
```
* if you use Python (I feel really sorry for you):
```
import requests
url = 'https://localhost/RunRecorder/api.php'
payload = {'action':'<action>',<data>}
headers = {'content-type': 'application/x-www-form-urlencoded'}
r = requests.post(url, data=payload, headers=headers)
print(str(r.text))
```

The API returns, when the request was successfull:
```
{"ret":"0", ...}
```
when the success failed:
```
{"errMsg":"something went wrong","ret":"1"}
```

### Check the version of the database

A first simple test to check if everything is working fine is to request the version of the database.

*The database version is automatically checked and the database is upgraded if needed by the API and C library.*

```
<action>: version
```

Example using the shell script:
```
> runrecorder.sh version
{"version":"01.00.00","ret":"0"}
```

### Help command

When using th Web API, if you have forgotten the list of available command, you can get them with the following command:

```
<action>: help
```

Example using the shell script:
```
> runrecorder.sh help
{"ret":"0","actions":"version, add_project&label=..., projects, add_metric&project=...&label=...&default=..., metrics&project=..., add_measure&project=...&...=...&..., delete_measure&measure=..., csv&project=..., flush&project=..."}
```

### Create a new project

In RunRecorder, data are grouped by projects. To start recording data, the first thing you need to do is to create the project they relate to.

```
<action>: add_project
<data>: label=<the project's name>
```

*The project's name must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`.*

Example using the shell script:
```
> runrecorder.sh add_project "label=RoomTemperature"
{"ret":"0"}
```


#### Get the projects

You can get the list of projects.

```
<action>: projects
```

Example using the shell script:
```
> runrecorder.sh projects
{"ret":"0","projects":{"1":"RoomTemperature"}}
```


#### Add a metric to a project

After adding a new project you'll probably want to add metrics that defines this project. In our example project there are two metrics: the date and time of the recording, and the recorded room temperature.

```
<action>: add_metric
<data>: project=<name of this metric's project>&label=<metric's name>&default=<default value of the metric>
```

*The metric's name must respect the following pattern: `/^[a-zA-Z][a-zA-Z0-9_]*$/`. The default of the metric must be one character long at least. The double quote `"`, equal sign `=` and ampersand `&` can't be used in the default value. There cannot be two metrics with the same label for the same project. A metric label can't be 'action' or 'project' (case sensitive, so 'Action' is fine).*

Example using the shell script:
```
> runrecorder.sh add_metric "project=RoomTemperature&label=Date&default=-"
{"ret":"0"}
> runrecorder.sh add_metric "project=RoomTemperature&label=Temperature&default=0.0"
{"ret":"0"}
```

You can add metrics even after having recorded data. A measurement with no value for a given metric automatically get attributed the default value of this metric.

#### Get the metrics of a project

You can get the list of metrics for a project.

```
<action>: metrics
<data>: project=<name of the project>
```

Example using the shell script:
```
> runrecorder.sh metrics "project=RoomTemperature"
{"metrics":{"1":"Date","2":"Temperature"},"ret":"0"}
```

#### Add a measurement to a project

Now you're ready to add measurements to your project!

```
<action>: add_measure
<data>: project=<name of the project>&<metric 1>=<value metric 1>&<metric 2>=<value metric 2>...
```

*The double quote `"`, equal sign `=` and ampersand `&` can't be used in the  value. A value must be at least one character long. It is not mandatory to provide a value for all the metrics of the project (if missing, the default value is used instead).*

Example using the shell script:
```
> runrecorder.sh add_measure "project=RoomTemperature&Date=2021-03-08 15:45:00&Temperature=18.5"
{"ret":"0","refMeasure":"1"}
> runrecorder.sh add_measure "project=RoomTemperature&Date=2021-03-08 16:19:00&Temperature=19.1"
{"ret":"0","refMeasure":"2"}
```

#### Delete a measure

If you've mistakenly added a measure and want to delete it, you can do so as long as you have memorised its reference (returned when you add it). Also, if an error occured when addind a measure, it may be partially saved in the database, depending on the error. RunRecorder ensures the database stays coherent even if there is an error, you can then use the partially saved data. In the other hand if you don't want to keep potentially incomplete measurement, in case of error during addition of measurement you should always try to delete it with the returned reference.

Example using the shell script:
```
> runrecorder.sh delete_measure "project=RoomTemperature&Measure=1"
{"ret":"0"}
```


#### Retrieve measurements from a project

Obviously after adding your measurements you'll want to use them. You can access directly the SQLite database with any compatible software, or you can retrieve them in CSV format using RunRecorder. 

```
<action>: csv
<data>: project=<name of the project>
```

Example using the shell script:
```
runrecorder.sh csv "project=RoomTemperature"
```

Example using the C library:
```
TODO
```

On success, the API returns, for example:
```
Date&Temperature
2021-03-08 15:45:00&18.5
2021-03-08 16:19:00&19.1
```

On failure, an error message is returned.
```
{"errMsg":"something went wrong","ret":"0"}
```

Metrics (columns) are ordered alphabetically, values (rows) are ordered by time of creation in the database. The delimiter is ampersand `&`, and the first line contains the label of metrics. All metrics of the project are present, and their default value is used in rows containing missing values.

#### Delete a project

Once you've finished collecting data for a project and want to free space in the database, you can delete the project and all the associated metrics and measurements. 

```
<action>: flush
<data>: project=<name of the project>
```

Example using the shell script:
```
runrecorder.sh flush "project=RoomTemperature"
```

Example using the C library:
```
TODO
```

On success, the API returns:
```
{"ret":"0"}
```

On failure, an error message is returned.
```
{"errMsg":"something went wrong","ret":"0"}
```

## 3 Web viewer

## 4 License

RunRecorder, a C library and a Web API helping to interface the acquisition of textual data and their recording in a remote or local SQLite database.
Copyright (C) 2021  Pascal Baillehache

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.

